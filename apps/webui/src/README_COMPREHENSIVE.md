# 天宫科技全屏视觉体验应用 - 完整使用指南

## 🚀 项目概述

这是一个基于React + TypeScript构建的全屏视觉体验应用，专注于银色主题的Shadertoy动画效果，集成音乐播放器、电台功能、音乐可视化器等核心功能。应用采用双模式设计：沉浸式欢迎界面和功能性控制台界面。

## 📚 文档索引

### 🔧 核心技术文档
- **[TECHNICAL_SPECIFICATIONS.md](./TECHNICAL_SPECIFICATIONS.md)** - 完整技术规范文档
  - 系统架构概览
  - 环境变量系统(50+配置项)
  - 全局状态管理
  - 性能监控和优化
  
- **[API_INTERFACES.md](./API_INTERFACES.md)** - API接口和组件通信规范
  - 所有组件接口定义
  - 数据流和状态管理
  - TypeScript类型系统
  - 组件间通信协议

- **[MODULE_PRINCIPLES_AND_LOGIC.md](./MODULE_PRINCIPLES_AND_LOGIC.md)** - 模块功能原理详解
  - 每个模块的工作原理
  - 按钮逻辑和交互设计
  - 弹窗显示/隐藏完整逻辑
  - 状态同步和数据流

### 🔧 配置和部署文档
- **[CONFIGURATION_GUIDE.md](./CONFIGURATION_GUIDE.md)** - 配置管理完整指南
  - 环境变量配置
  - 构建配置优化
  - 部署检查清单
  - 配置验证工具

- **[MODAL_SYSTEM_DIAGNOSIS.md](./MODAL_SYSTEM_DIAGNOSIS.md)** - 弹窗系统诊断修复指南
  - 弹窗显示问题诊断
  - 5种常见问题的修复方案
  - 自动诊断工具
  - 部署时错误排查

### 📖 开发文档
- **[DEVELOPMENT.md](./DEVELOPMENT.md)** - 开发文档和版本历史
  - 项目结构和组织
  - 开发环境设置
  - 版本更新记录
  - 贡献指南

## 🎯 核心功能模块

### 1. 双模式系统
```
欢迎模式 (Welcome Mode)     控制台模式 (Console Mode)
    ↓ 点击任意位置               ↓ 点击时钟模块
控制台模式 ←─────────────→ 欢迎模式
```

**欢迎模式特征**:
- 全屏Shadertoy背景动画
- 居中大型时钟显示
- 空间站状态信息面板
- 沉浸式视觉体验

**控制台模式特征**:
- 左上角时钟模块(返回按钮)
- 中央音乐整理器面板
- 右侧任务日志系统
- 右上角四控件工具栏

### 2. 背景管理系统 (BackgroundManager)
- **5个内置Shadertoy着色器**:
  1. 银色粒子流 - 液态金属粒子流动效果
  2. 量子场效应 - 科幻感能量场波动
  3. 星云漂移 - 深空星云缓慢移动
  4. 能量波纹 - 中心向外扩散波纹
  5. 液态银河 - 流动银色液体星系

- **自动轮换系统**: 每次页面加载自动切换到下一个着色器
- **性能优化**: GPU监控、内存管理、移动端适配
- **鼠标交互**: 微弱的鼠标跟随动画效果

### 3. 右上角四控件系统

#### 控件布局
```
[🎵 可视化器] [🌟 背景] [🌐 语言] [📻 电台]
   right-56    right-40   right-24   right-8
```

#### 📻 电台控制按钮 (right-8)
- **功能**: 切换TiangongRadioPlayer浮窗显示/隐藏
- **特色**: 可拖拽浮窗，智能边缘吸附
- **同步功能**: ✅ **已优化Sync按钮闪烁亮度**
  - 从`rgba(192, 197, 206, 0.08)`提升到`rgba(192, 197, 206, 0.25)`
  - 新增脉冲动画和发光效果
  - 支持三级同步：本地同步、设备间同步、云端同步

#### 🌐 语言切换按钮 (right-24)  
- **功能**: 中文(zh)和英文(en)之间切换
- **显示逻辑**: 
  - 中文模式显示"EN"(提示可切换到英文)
  - 英文模式显示"中"(提示可切换到中文)
- **持久化**: 自动保存到localStorage

#### 🌟 背景切换按钮 (right-40)
- **功能**: 手动切换5个Shadertoy背景着色器  
- **轮换逻辑**: 按顺序循环切换，记录当前索引
- **视觉反馈**: 显示当前着色器名称和编号

#### 🎵 音乐可视化器按钮 (right-56)
- **功能**: 打开独立的Web音乐可视化器窗口
- **配置**: `http://localhost:8080/visualizer`
- **窗口管理**: 1200x800大小，支持调整和滚动
- **通信**: 与主应用建立音频数据传输通道

### 4. 电台播放器系统 (TiangongRadioPlayer)

#### 🧲 智能吸附系统
```typescript
// 三种状态循环
Free → Snapped → Expanded → Free
自由     吸附      展开      自由
```

- **吸附算法**: 自动检测距离最近的屏幕边缘
- **位置记忆**: 记住用户偏好的自由位置
- **响应式适配**: 窗口大小变化时自动调整位置

#### 🎵 音频功能
- **Wavesurfer.js v7集成**: 10秒窗口波形显示
- **实时波形**: 动态音频可视化效果
- **音量控制**: 精确音量调节滑块
- **播放状态**: 视觉化播放指示器

#### 🔄 同步功能增强
- **高亮闪烁**: 显著提升sync按钮视觉反馈
- **脉冲动画**: `radioSyncPulse`关键帧动画
- **三级亮度**: 基础(0.25) → 脉冲(0.45) → 交互(0.55)
- **无障碍支持**: `prefers-reduced-motion`适配

### 5. 音乐整理器系统 (AdvancedMusicOrganizer)

#### 📥 导入导出功能
- **Spotify**: OAuth认证 + Web API集成
- **网易云音乐**: 歌单ID解析和数据抓取
- **本地文件**: JSON/CSV/M3U多格式支持
- **智能分类**: AI驱动的自动分类算法

#### 🔍 搜索和过滤
- **模糊搜索**: 基于Fuse.js的智能搜索
- **多维过滤**: 按类型、艺术家、年份、时长过滤
- **实时结果**: 键入即搜的响应式体验

### 6. 时钟显示系统 (TimeDisplay)

#### 双重身份设计
- **欢迎模式**: 大型居中时钟，点击进入控制台
- **控制台模式**: 紧凑左上角时钟，点击返回欢迎
- **地理位置**: 自动检测并显示当前位置信息
- **格式自适应**: 支持12/24小时制，多时区显示

### 7. 空间站状态系统 (EnhancedSpaceStationStatus)

#### 🛸 实时模拟数据
- **轨道参数**: 高度408km，周期92.68分钟，倾角51.6°
- **系统状态**: 电力、通信、生命支持、姿态控制
- **任务信息**: 当前阶段、在轨天数、实验进度
- **船员状态**: 姓名、角色、国籍、飞行经验

#### 📊 可视化展示
- **轨道追踪**: 实时位置和地面轨迹
- **可见性窗口**: 预测过境时间和观测条件
- **状态指示器**: 彩色编码的系统健康状态

### 8. 任务日志系统 (TaskLogger)

#### 📝 智能日志管理
- **多级日志**: debug, info, warn, error, critical
- **自动过滤**: 去重、合并、优先级排序
- **性能分析**: 瓶颈识别和趋势分析
- **导出功能**: JSON/CSV/TXT多格式导出

## 🔧 技术特色

### 🎨 银色主题设计系统
- **核心色彩**: #c0c5ce, #a8b2c4, #9399a8
- **透明度系统**: 5% → 80%精确渐变控制
- **无毛玻璃**: 完全移除backdrop-filter效果
- **统一字体**: SF Pro + SF Mono字体族

### ⚡ 性能优化策略
- **GPU监控**: 实时FPS和内存使用监控
- **懒加载**: 组件和资源按需加载
- **代码分割**: React.lazy + Suspense
- **缓存策略**: localStorage + IndexedDB双重缓存

### 🌐 国际化系统
- **动态翻译**: 无刷新语言切换
- **上下文感知**: 根据模块自动调整翻译
- **后备机制**: 多级语言后备系统
- **自动检测**: 浏览器语言自动识别

### 🔄 状态管理架构
```typescript
// 全局状态流
输入源 → 处理器 → 输出
UserEvents → StateReducer → ComponentProps
SystemEvents → SideEffectHandler → DOMUpdates  
NetworkData → PersistenceManager → SideEffects
```

## 🚀 快速开始

### 1. 环境准备
```bash
# Node.js版本要求
node >= 18.0.0
npm >= 9.0.0

# 克隆项目
git clone <repository-url>
cd tiangong-visual-experience

# 安装依赖
npm ci
```

### 2. 环境配置
```bash
# 复制环境变量模板
cp .env.example .env

# 根据需要修改配置
nano .env
```

### 3. 启动开发服务器
```bash
# 启动主应用
npm run dev

# 启动Termusic后端 (可选)
# 需要单独安装和配置Termusic

# 启动音乐可视化器 (可选) 
# 需要单独部署可视化器服务
```

### 4. 构建生产版本
```bash
# 构建
npm run build

# 预览构建结果
npm run preview
```

## 🔍 问题排查

### 弹窗不显示问题
1. **运行诊断**: 在浏览器控制台执行`diagnoseModals()`
2. **检查Z-Index**: 确认没有层级冲突
3. **验证Portal**: 检查`#modal-root`容器是否存在
4. **样式冲突**: 查看CSS的`pointer-events`和`overflow`设置

详细排查请参考 [MODAL_SYSTEM_DIAGNOSIS.md](./MODAL_SYSTEM_DIAGNOSIS.md)

### 性能问题
1. **FPS监控**: 检查是否低于30fps
2. **内存使用**: 监控GPU内存占用
3. **着色器复杂度**: 考虑降低质量设置
4. **组件优化**: 使用React.memo和useMemo

### 音频问题
1. **浏览器兼容性**: 确认Web Audio API支持
2. **权限设置**: 检查麦克风/音频权限
3. **网络连接**: 验证电台流地址可访问
4. **Wavesurfer配置**: 检查版本和配置参数

## 📈 扩展开发

### 添加新的着色器
1. 在`/components/util/shaders.ts`中定义新着色器
2. 更新`VITE_SHADER_COUNT`环境变量
3. 添加对应的翻译文本
4. 测试性能和兼容性

### 集成新的音乐服务
1. 实现对应的API接口适配器
2. 在`AdvancedMusicOrganizer`中注册新服务
3. 添加认证和权限处理
4. 更新导入导出逻辑

### 自定义主题
1. 修改CSS变量系统
2. 调整银色色彩配置
3. 更新组件样式类
4. 测试暗色模式兼容性

## 🤝 贡献指南

### 代码规范
- **TypeScript**: 严格类型检查
- **ESLint**: 代码质量检查
- **Prettier**: 代码格式化
- **Conventional Commits**: 提交信息规范

### 测试要求
- **单元测试**: 核心逻辑覆盖
- **集成测试**: 组件交互测试
- **E2E测试**: 关键用户流程
- **性能测试**: 内存和FPS基准

### 文档维护
- **API文档**: 接口变更时更新
- **用户指南**: 功能变更时更新
- **技术文档**: 架构变更时更新
- **版本日志**: 每次发布时更新

## 📄 许可证

MIT License - 详见 [LICENSE](./LICENSE) 文件

## 👥 团队

**开发团队**: 天宫科技  
**主要开发者**: 麻蛇  
**项目版本**: v2.1.0  
**最后更新**: 2025-01-25

---

## 🔗 相关链接

- [Termusic播放器](https://github.com/tramhao/termusic) - Rust音乐播放器后端
- [Wavesurfer.js](https://wavesurfer-js.org/) - 音频波形可视化库
- [Motion](https://motion.dev/) - React动画库
- [Tailwind CSS v4](https://tailwindcss.com/) - 样式框架

---

*这个应用代表了现代Web技术的融合：React的组件化、TypeScript的类型安全、WebGL的视觉效果、Web Audio的音频处理，以及精心设计的用户体验。*