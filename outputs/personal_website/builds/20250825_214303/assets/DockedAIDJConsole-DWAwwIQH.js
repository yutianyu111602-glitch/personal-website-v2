import{r as i,j as a,A as N,m as b,R as w}from"./index-UUwbguUC.js";class u{eventMap=new Map;isEnabled=!0;batchQueue=[];batchTimeout=null;batchSize=10;batchDelay=16;debounceMap=new Map;debounceDelay=100;performanceMetrics={totalEvents:0,batchEvents:0,debouncedEvents:0,averageLatency:0,lastUpdate:Date.now()};on(e,o,n){const l=`${e}:${o}`;return this.eventMap.has(l)||this.eventMap.set(l,new Set),this.eventMap.get(l).add(n),()=>{const s=this.eventMap.get(l);s&&(s.delete(n),s.size===0&&this.eventMap.delete(l))}}emit(e,o={}){if(!this.isEnabled)return;const n=performance.now();if(o.batch)this.batchQueue.push(e),this.performanceMetrics.batchEvents++,this.batchQueue.length>=this.batchSize?this.flushBatch():this.batchTimeout||(this.batchTimeout=setTimeout(()=>this.flushBatch(),this.batchDelay));else if(o.debounce){const s=`${e.namespace}:${e.type}`;this.debounceMap.has(s)&&clearTimeout(this.debounceMap.get(s)),this.debounceMap.set(s,setTimeout(()=>{this.debounceMap.delete(s),this.emitImmediate(e)},this.debounceDelay)),this.performanceMetrics.debouncedEvents++}else this.emitImmediate(e);this.performanceMetrics.totalEvents++;const l=performance.now()-n;this.performanceMetrics.averageLatency=(this.performanceMetrics.averageLatency*(this.performanceMetrics.totalEvents-1)+l)/this.performanceMetrics.totalEvents,this.performanceMetrics.lastUpdate=Date.now()}emitImmediate(e){const o=`${e.namespace}:${e.type}`,n=this.eventMap.get(o);n&&n.forEach(l=>{try{l(e)}catch(s){console.warn("LocalBus callback error:",s)}})}flushBatch(){if(this.batchTimeout&&(clearTimeout(this.batchTimeout),this.batchTimeout=null),this.batchQueue.length===0)return;const e=[...this.batchQueue];this.batchQueue=[],e.forEach(o=>{this.emitImmediate(o)}),console.log(`🚀 LocalBus: 批量处理了 ${e.length} 个事件`)}emitBpm(e){this.emit({namespace:"automix",type:"bpm",data:{bpm:e},timestamp:Date.now()})}emitPlayback(e){this.emit({namespace:"automix",type:"playback",data:{playbackState:e},timestamp:Date.now()})}emitPreset(e){this.emit({namespace:"visualization",type:"preset",data:{name:e},timestamp:Date.now()})}emitMood(e){this.emit({namespace:"automix",type:"mood",data:{mood:e},timestamp:Date.now()})}emitTransition(e,o){this.emit({namespace:"automix",type:"transition",data:{action:e,durationMs:o},timestamp:Date.now()})}emitTechniqueSelect(e){this.emit({namespace:"automix",type:"technique_select",data:{technique:e},timestamp:Date.now()})}emitPresetForce(e){this.emit({namespace:"visualization",type:"preset_force",data:{name:e},timestamp:Date.now()})}setEnabled(e){this.isEnabled=e}getStatus(){let e=0;return this.eventMap.forEach(o=>{e+=o.size}),{enabled:this.isEnabled,eventCount:this.eventMap.size,activeSubscriptions:e,performanceMetrics:{...this.performanceMetrics}}}clear(){this.eventMap.clear()}getActiveEventTypes(){return Array.from(this.eventMap.keys())}setBatchConfig(e,o){this.batchSize=Math.max(1,e),this.batchDelay=Math.max(1,o)}setDebounceDelay(e){this.debounceDelay=Math.max(0,e)}emitBatch(e){this.emit(e,{batch:!0})}emitDebounced(e){this.emit(e,{debounce:!0})}}const k=new u;typeof window<"u"&&(window.LocalBus=u,window.localBus=k);function P(){const[c,e]=i.useState(null);return i.useEffect(()=>{const o=window.UnifiedEventBus,n=window.localBus||new u;o||(window.UnifiedEventBus=n),e(o||n)},[]),c}const m=w.memo(({onClick:c,children:e,variant:o="primary",disabled:n=!1})=>{const l=i.useMemo(()=>{const s={padding:"10px 12px",borderRadius:"10px",cursor:n?"not-allowed":"pointer",fontSize:"12px",border:"1px solid",transition:"all 0.2s ease",opacity:n?.5:1};switch(o){case"primary":return{...s,background:"rgba(0, 255, 136, 0.1)",color:"#00ff88",borderColor:"rgba(0, 255, 136, 0.3)"};case"secondary":return{...s,background:"rgba(255, 255, 255, 0.06)",color:"#eaf0ff",borderColor:"rgba(215, 225, 245, 0.18)"};case"danger":return{...s,background:"rgba(255, 68, 68, 0.1)",color:"#ff4444",borderColor:"rgba(255, 68, 68, 0.3)"};default:return s}},[o,n]);return a.jsxDEV("button",{onClick:c,disabled:n,style:l,onMouseEnter:s=>{n||(s.currentTarget.style.transform="scale(1.02)",s.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)")},onMouseLeave:s=>{n||(s.currentTarget.style.transform="scale(1)",s.currentTarget.style.boxShadow="none")},children:e},void 0,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:76,columnNumber:5},void 0)});m.displayName="ControlButton";const E=()=>{const c=P(),[e,o]=i.useState(!1),[n,l]=i.useState(!1),s=i.useCallback(t=>{t?.data?.active!==void 0?o(t.data.active):o(d=>!d)},[]);i.useEffect(()=>{if(!c?.on)return;const t=c.on("ui","sync_toggle",s);return()=>{t&&t()}},[c,s]);const r=i.useCallback(t=>{if(c?.emit)try{c.emit(t)}catch(d){console.warn("Event emission failed:",d)}},[c]),h=i.useCallback(()=>{r({namespace:"automix",type:"transition",data:{action:"next"},timestamp:Date.now()})},[r]),g=i.useCallback(()=>{r({namespace:"automix",type:"transition",data:{action:"prev"},timestamp:Date.now()})},[r]),p=i.useCallback(t=>{r({namespace:"automix",type:"transition",data:{action:"crossfade",durationMs:t},timestamp:Date.now()})},[r]),f=i.useCallback(()=>{r({namespace:"automix",type:"mood",data:{mood:{energy:.85}},timestamp:Date.now()})},[r]),x=i.useCallback(()=>{r({namespace:"automix",type:"mood",data:{mood:{energy:.3}},timestamp:Date.now()})},[r]),y=i.useCallback(t=>{r({namespace:"visualization",type:"preset_force",data:{name:t},timestamp:Date.now()})},[r]),D=i.useCallback(t=>{r({namespace:"automix",type:"technique_select",data:{technique:t},timestamp:Date.now()})},[r]),C=i.useMemo(()=>[{name:"silver_pure",label:"Silver Pure"},{name:"silver_mist",label:"Silver Mist"},{name:"liquid_chrome",label:"Liquid Chrome"},{name:"metallic_flow",label:"Metallic Flow"},{name:"cosmic_silver",label:"Cosmic Silver"}],[]),v=i.useMemo(()=>[{name:"double_drop_32",label:"Double Drop 32"},{name:"bass_swap",label:"Bass Swap"},{name:"phrase_cut_16",label:"Phrase Cut 16"},{name:"long_layer_24",label:"Long Layer 24"}],[]);return a.jsxDEV(a.Fragment,{children:[a.jsxDEV(N,{children:e&&a.jsxDEV(b.div,{initial:{y:400,opacity:0},animate:{y:0,opacity:1},exit:{y:400,opacity:0},transition:{type:"spring",stiffness:320,damping:30},style:{position:"fixed",left:"16px",right:"16px",bottom:"16px",maxWidth:"960px",height:"360px",margin:"0 auto",borderRadius:"16px",background:"rgba(11, 15, 20, 0.95)",border:"1px solid rgba(215, 225, 245, 0.14)",boxShadow:"0 16px 50px rgba(0, 0, 0, 0.45)",zIndex:90,display:"grid",gridTemplateColumns:"1.2fr 0.8fr",gap:"12px",padding:"12px",backdropFilter:"blur(20px)"},children:[a.jsxDEV("div",{style:{border:"1px solid rgba(215, 225, 245, 0.12)",borderRadius:"12px",padding:"16px",background:"rgba(255, 255, 255, 0.02)"},children:[a.jsxDEV("div",{style:{marginBottom:"16px",fontSize:"14px",color:"#dfe6ff",fontWeight:"600",textAlign:"center"},children:"AI情绪监控"},void 0,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:261,columnNumber:15},void 0),a.jsxDEV("div",{style:{height:"280px",display:"flex",alignItems:"center",justifyContent:"center",color:"rgba(255, 255, 255, 0.5)",fontSize:"12px"},children:"情绪监控组件将在这里显示"},void 0,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:272,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:255,columnNumber:13},void 0),a.jsxDEV("div",{style:{display:"grid",gridTemplateRows:"auto auto 1fr",gap:"12px"},children:[a.jsxDEV("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"8px"},children:[a.jsxDEV(m,{onClick:g,variant:"secondary",children:"⏮ Prev"},void 0,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:296,columnNumber:17},void 0),a.jsxDEV(m,{onClick:h,variant:"secondary",children:"⏭ Next"},void 0,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:299,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:291,columnNumber:15},void 0),a.jsxDEV("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"8px"},children:[a.jsxDEV(m,{onClick:()=>p(2500),variant:"secondary",children:"↔ Cross 2.5s"},void 0,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:309,columnNumber:17},void 0),a.jsxDEV(m,{onClick:()=>p(4500),variant:"secondary",children:"↔ Cross 4.5s"},void 0,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:312,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:304,columnNumber:15},void 0),a.jsxDEV("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"8px"},children:[a.jsxDEV(m,{onClick:f,variant:"primary",children:"⚡ Boost"},void 0,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:323,columnNumber:17},void 0),a.jsxDEV(m,{onClick:x,variant:"secondary",children:"🌙 Calm"},void 0,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:326,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:318,columnNumber:15},void 0),a.jsxDEV("div",{style:{border:"1px solid rgba(215, 225, 245, 0.12)",borderRadius:"12px",padding:"10px",background:"rgba(255, 255, 255, 0.02)"},children:[a.jsxDEV("div",{style:{marginBottom:"8px",fontSize:"12px",color:"#dfe6ff"},children:"预设 / 手法"},void 0,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:338,columnNumber:17},void 0),a.jsxDEV("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"6px",marginBottom:"8px"},children:C.map(t=>a.jsxDEV(m,{onClick:()=>y(t.name),variant:"secondary",children:t.label},t.name,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:354,columnNumber:21},void 0))},void 0,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:347,columnNumber:17},void 0),a.jsxDEV("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"6px"},children:v.map(t=>a.jsxDEV(m,{onClick:()=>D(t.name),variant:"secondary",children:t.label},t.name,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:371,columnNumber:21},void 0))},void 0,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:365,columnNumber:17},void 0)]},void 0,!0,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:332,columnNumber:15},void 0)]},void 0,!0,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:285,columnNumber:13},void 0)]},"dock",!0,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:224,columnNumber:11},void 0)},void 0,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:222,columnNumber:7},void 0),a.jsxDEV(b.button,{onClick:()=>o(!0),style:{position:"fixed",bottom:"20px",right:"20px",width:"60px",height:"60px",borderRadius:"50%",background:"rgba(0, 255, 136, 0.2)",border:"1px solid rgba(0, 255, 136, 0.4)",color:"#00ff88",cursor:"pointer",fontSize:"24px",display:"flex",alignItems:"center",justifyContent:"center",zIndex:89,backdropFilter:"blur(10px)"},whileHover:{scale:1.1},whileTap:{scale:.9},initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.3},children:"🎛️"},void 0,!1,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:387,columnNumber:7},void 0)]},void 0,!0,{fileName:"/Users/masher/code/程序集_Programs/个人网站项目V2/apps/webui/src/components/TiangongRadioPlayer/uiComponents/DockedAIDJConsole.tsx",lineNumber:220,columnNumber:5},void 0)};export{E as default};
